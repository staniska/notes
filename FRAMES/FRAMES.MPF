;Переменная с пустым фреймом
DEF FRAME NULL
;Переменная для счетчика фреймов
DEF INT WKS_NUM
;G500 нельзя обнулить через $P_UIFR[0]
;Можно только через $P_UBFR или $P_CHBFR[0]
;Причем изменения вступят в силу только после команды G500 или G54-57 или G505-599
$P_UBFR=NULL
M0
STOPRE
G500
;Изменения базы вступили в силу

;Скидываем инструмент
;На токарном станке с револьвером инструмент физически не поменяется. Отключится коррекция на длину.
T0 M6

;Обнуляем Фреймы с 1 по 4 присвоением $P_UIFR
FOR WKS_NUM=1 TO 4
$P_UIFR[WKS_NUM]=NULL
ENDFOR

M0
STOPRE
;Включаем G54
G54
;Задаем смещение по Z=20мм
$P_UIFR[1,Z,TR]=20
M0
STOPRE
;Изменения вступают в силу после вызова G54
G54
G0 Z0
;Сейчас в WCS - Z0, MCS - Z20
M0
STOPRE
;Теперь для нашего фрейма NULL зададим смещение по Z=30
NULL=CTRANS(Z,30)
;и присвоим его значение базовому фрейму
$P_CHBFR[0]=NULL
M0
STOPRE
;Для активации изменений базового фрейма воспользуемся G54
G54
M0
STOPRE
;Зададим смещение системы координат через TRANS. Это смещение активируется сразу
TRANS Z50
M0
STOPRE
;Теперь переместимся в Z0. WCS: Z0, MCS: Z100 (30 + 20 + 50)
G0 Z0
M0
STOPRE
;Теперь отключим программируемый фрейм (TRANS Z50)
;Простой команды для его покадрового отключения нет. Можно вызвать пустой TRANS, а потом написать нужное нам смещение заново.
;Или можно сохранить наш программный фрейм на будущее
;Для начала сохраним его в нашу переменную.
NULL=$P_PFRAME
;Теперь сбросим. Тут можно написать СTRANS(), СROT() и т.д. любой из них, главное с пустым аргументом
$P_PFRAME=CROT()
;Переезжаем в Z0. Попадаем в WCS: Z0 , MCS: Z50 (30+20)
G0 Z0
M0
STOPRE
;Восстанавливаем наш транс и едем обратно в Z0 (MCS: Z100(30+20+50))
$P_PFRAME=NULL
G0 Z0
M0
STOPRE
;G53 Отключает покадрово Программируемый фрейм и устанавливаемый фрейм, базовый остается работать
G53 G0 Z0
M0
STOPRE
;А вот G153 отключит еще и базовый покадрово
G153 G0 Z0
M0
STOPRE
;SUPA дополнительно отключит смещение DRF. Я предпочитаю использовать его, так нагляднее. Хотя использование DRF на симуляторе не показать.
SUPA G0 Z0
M0
STOPRE


;Теперь активируем инструмент и попробуем выйти в MCS: Z0
T="CUTTER 4" D1 M6
G0 Z0
SUPA G0 Z0
;Не доехал на длину инструмента
M0
STOPRE
;Отключим коррекцию и доедем уже до MCS: Z0
D0 
SUPA G0 Z0

M0
STOPRE
;Для моделирования это не очень хорошо. Исчезает возможность контролировать столкновения. Поэтому нужно использовать следующую конструкцию
;Включаем обратно инструмент
D1
;Переместимся в MCS: Z20 с активным инструментом
SUPA G0 Z=20-$P_TOOLL[1]
M0
M30